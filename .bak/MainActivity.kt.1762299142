package od.app.ui
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.viewModels
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.material3.*
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp

class MainActivity : ComponentActivity() {
    private val vm: MainViewModel by viewModels()
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            val s by vm.state.collectAsState()
            Surface {
                Column(Modifier.fillMaxSize().padding(16.dp), verticalArrangement = Arrangement.spacedBy(12.dp)) {
                    Text("OD Idle", style = MaterialTheme.typography.headlineSmall)
                    val c = s.character
                    if (c != null) {
                        Text("Name: ${c.name}")
                        Text("Class: ${c.clazz}  Race: ${c.race}")
                        Text("STR:${c.str} DEX:${c.dex} CON:${c.con} INT:${c.intel} WIS:${c.wis} CHA:${c.cha}")
                        Text("ATK:${c.attack}  HP:${c.hp}")
                    } else Text("Loading...")
                    Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
                        Button(onClick = { vm.start(Difficulty.EASY) }, enabled = !s.running) { Text("Start EASY") }
                        Button(onClick = { vm.start(Difficulty.NORMAL) }, enabled = !s.running) { Text("Start NORMAL") }
                        Button(onClick = { vm.start(Difficulty.HARD) }, enabled = !s.running) { Text("Start HARD") }
                        Button(onClick = { vm.stop() }, enabled = s.running) { Text("Stop") }
                    }
                    Text("Log:")
                    LazyColumn(Modifier.weight(1f)) { items(s.log) { Text(it) } }
                }
            }
        }
    }
}
